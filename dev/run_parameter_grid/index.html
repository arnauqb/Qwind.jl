<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running a parameter grid · Qwind Documentation</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Qwind Documentation</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">QWIND</a></li><li><a class="tocitem" href="../Setup/">Setup</a></li><li><a class="tocitem" href="../Usage/">Usage</a></li><li><a class="tocitem" href="../change_fm/">Using a different force multiplier</a></li><li><a class="tocitem" href="../example1/">Example 1: Mdot dependence with radius</a></li><li class="is-active"><a class="tocitem" href>Running a parameter grid</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Running a parameter grid</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running a parameter grid</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/arnauqb/Qwind.jl/blob/master/docs/src/run_parameter_grid.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Running-a-parameter-grid"><a class="docs-heading-anchor" href="#Running-a-parameter-grid">Running a parameter grid</a><a id="Running-a-parameter-grid-1"></a><a class="docs-heading-anchor-permalink" href="#Running-a-parameter-grid" title="Permalink"></a></h1><p>The main goal of Qwind is to be able to run fast parameter searches. To make it easy, the user can specify ranges to vary in the parameter file. </p><p>Let&#39;s illustrate this with an example changing BH mass and mass accretion rate. The parameter file we use (located at <code>configs/parameter_scan_example.yaml</code> ) is</p><pre><code class="language-yaml hljs">system:
  qwind_path: /path/to/Qwind.jl
  n_cpus: 16
  partition: cosma
  account: durham
  max_time: 72:00:00
  job_name: qwind

black_hole:
  M: &quot;@vary grid 1e8,1e9,1e10&quot; # take the values specified
  mdot: &quot;@vary log 0.1 0.5 5&quot; # from 0.1 to 0.5, 5 values log spaced
  spin: 0.0

radiation:
  relativistic: true
  f_uv: 0.85
  f_x: 0.15
  n_r: 2000
  disk_r_in: 6.0
  z_xray: 0.0
  disk_height: 0.0
  uv_opacity: thomson
  xray_opacity: boost 
  xray_scattering: false
  tau_uv_calculation: no_tau_uv
  vacuum_density: 1e2
  update_grid_method: &quot;average&quot;
  grid_nz: 250
  grid_nr: auto
  mu_nucleon: 0.61

initial_conditions:
  mode: cak
  r_in: 20.0
  r_fi: 1500.0
  n_trajs: 50
  z0: 0.0 
  K: 0.03
  alpha: 0.6
  use_precalculated: false

integrator:
  n_iterations: 5
  save_path: &quot;./parameter_scan_example&quot;
  integrator_r_min: 6.0
  integrator_r_max: 10000.0
  integrator_z_min: 0.0
  integrator_z_max: 10000.0

numerical_tolerances:
  disk_integral_atol: 0
  disk_integral_rtol: 1e-3
  disk_integral_maxevals: 10000
  integrator_atol: 1e-8
  integrator_rtol: 1e-3
  scattering_atol: 0
  scattering_rtol: 1e-3</code></pre><p>The first config blog is the <code>system</code> configuration block, which specifies the path to our Qwind installation, the number of cpus to use for each model, the partition and account of our HPC cluster, the maximum time of the job, and the job name. Note that this only works for a SLURM scheduler.</p><p>We specify the BH mass and mass accretion rate to vary in a certain range. For the BH mass we have specified a grid of values, and for mdot we specify a log range. Another possible option could have been <code>@vary linear 0.1 0.5 5</code> which would have varied the value linearly rather than in log-space. </p><p>We can now create a folder hierarchy structure with the variations like this</p><pre><code class="language-julia hljs">using Qwind
create_models_folders(&quot;configs/parameter_scan_example.yaml&quot;)</code></pre><p>This will create a folder called <code>parameter_scan_example</code> with the following structure</p><pre><code class="nohighlight hljs">├── all_configs.yaml
|
├── model_001
│   ├── config.yaml
│   ├── submit.sh
├── model_002
│   ├── config.yaml
│   ├── submit.sh
...
├── run_model.jl
├── stdout
├── submit_all.sh
└── all_configs.yaml</code></pre><p>In total we can see 15 models, as we would expect from 3 x 5. Each model has its own <code>config.yaml</code> plus a submit script for our system. We can then submit the scripts one by one, or submit them all at once with <code>bash submit_all.sh</code>. The logs of the jobs will be stored in the <code>stdout</code> folder.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example1/">« Example 1: Mdot dependence with radius</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.17 on <span class="colophon-date" title="Sunday 15 May 2022 17:18">Sunday 15 May 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
